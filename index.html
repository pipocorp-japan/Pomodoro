<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ポモドーロタイマー</title>
  <!-- Android Material Design風 -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #FAFAFA;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #container {
      text-align: center;
      background: #FFFFFF;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 2rem;
      position: relative;
      width: 280px;
    }
    #timer {
      font-size: 3.5rem;
      color: #212121;
      margin-bottom: 1rem;
    }
    .fab {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: #6200EE;
      color: #FFFFFF;
      border: none;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      box-shadow: 0 6px 10px rgba(0,0,0,0.3);
      cursor: pointer;
    }
    #startPause { position: relative; }
    #settingsBtn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #03DAC5;
      font-size: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    #overlay, #settingsDialog { display: none; }
    #overlay.active {
      display: block;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      z-index: 5;
    }
    #settingsDialog.active {
      display: block;
      position: fixed;
      top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: #FFFFFF;
      padding: 1.5rem;
      box-shadow: 0 6px 10px rgba(0,0,0,0.3);
      border-radius: 8px;
      z-index: 10;
      width: 260px;
      text-align: left;
    }
    label { display: block; margin: 0.5rem 0; font-size: 1rem; color: #424242; }
    input[type=number] { width: 60px; font-size: 1rem; padding: 0.2rem; }
    #saveSettings {
      margin-top: 1rem;
      width: 100%;
      padding: 0.5rem;
      background-color: #6200EE;
      color: #FFFFFF;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <audio id="alarm" src="alarm.mp3" preload="auto"></audio>
  <div id="overlay"></div>
  <div id="settingsDialog">
    <h2>設定</h2>
    <label>作業時間: <input id="workInput" type="number" min="1" /> 分</label>
    <label>休憩時間: <input id="breakInput" type="number" min="1" /> 分</label>
    <button id="saveSettings">保存</button>
  </div>
  <div id="container">
    <div id="settingsBtn" class="material-icons">settings</div>
    <div id="timer">25:00</div>
    <button id="startPause" class="fab"><span class="material-icons" id="startIcon">play_arrow</span></button>
  </div>

  <script>
  (() => {
    const timerEl = document.getElementById('timer');
    const startBtn = document.getElementById('startPause');
    const startIcon = document.getElementById('startIcon');
    const settingsBtn = document.getElementById('settingsBtn');
    const dialog = document.getElementById('settingsDialog');
    const overlay = document.getElementById('overlay');
    const workInput = document.getElementById('workInput');
    const breakInput = document.getElementById('breakInput');
    const saveBtn = document.getElementById('saveSettings');
    const alarm = document.getElementById('alarm');

    let workMinutes = parseInt(localStorage.getItem('work')) || 25;
    let breakMinutes = parseInt(localStorage.getItem('break')) || 5;
    let isWork = true;
    let remaining = parseInt(localStorage.getItem('pausedRemaining')) || workMinutes * 60;
    let timerID = null;

    const updateDisplay = () => {
      const m = String(Math.floor(remaining / 60)).padStart(2,'0');
      const s = String(remaining % 60).padStart(2,'0');
      timerEl.textContent = `${m}:${s}`;
    };
    updateDisplay();

    const tick = () => {
      if (remaining > 0) {
        remaining--; updateDisplay();
      } else {
        clearInterval(timerID);
        alarm.play();
        const mode = isWork ? '作業' : '休憩';
        const action = isWork ? '休憩' : '集中';
        const msg = `${mode}時間が終わりました！\n終了するにはキャンセルかいいえ、${action}するにはOKかはいを押してください！`;
        if (confirm(msg)) {
          isWork = !isWork;
        }
        localStorage.setItem(isWork ? 'work' : 'break', isWork ? workMinutes : breakMinutes);
        remaining = (isWork ? workMinutes : breakMinutes) * 60;
        toggleTimer();
      }
    };

    const startTimer = () => {
      timerID = setInterval(tick, 1000);
      startIcon.textContent = 'pause';
      settingsBtn.style.visibility = 'hidden';
    };
    const pauseTimer = () => {
      clearInterval(timerID);
      startIcon.textContent = 'play_arrow';
      settingsBtn.style.visibility = 'visible';
      localStorage.setItem('pausedRemaining', remaining);
    };

    const toggleTimer = () => {
      timerID ? pauseTimer() : startTimer();
    };

    startBtn.addEventListener('click', toggleTimer);

    settingsBtn.addEventListener('click', () => {
      dialog.classList.add('active');
      overlay.classList.add('active');
      workInput.value = workMinutes;
      breakInput.value = breakMinutes;
    });
    saveBtn.addEventListener('click', () => {
      workMinutes = Math.max(5, parseInt(workInput.value));
      breakMinutes = Math.max(1, parseInt(breakInput.value));
      localStorage.setItem('work', workMinutes);
      localStorage.setItem('break', breakMinutes);
      remaining = workMinutes * 60;
      updateDisplay();
      dialog.classList.remove('active');
      overlay.classList.remove('active');
    });
  })();
  </script>
</body>
</html>
